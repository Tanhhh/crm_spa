@using Erp.BackOffice.App_GlobalResources
@using Erp.BackOffice.Helpers
@using Erp.BackOffice.Sale.Models
@using Erp.BackOffice.Account.Models
@using Erp.BackOffice.Sale.Models
@using Erp.BackOffice.Areas.Cms.Models
@using Erp.BackOffice.Filters;

@{
    var brandId = ViewBag.BrandId != null ? ViewBag.BrandId : null;
    IEnumerable<CategoryViewModel> origin = (IEnumerable<CategoryViewModel>)ViewBag.category;
    var datalist = ViewBag.DataList as IEnumerable<LeadProduct>;
    var i = 0;
    decimal totalt = 0;
    decimal thanh_tien = 0;
}
<link href="/assets/css/combojax.css" rel="stylesheet" />
<style type="text/css">

    .item {
        /*width: 600px !important;*/
        height: 90px !important;
    }

    /*.itemdiv > .body {
            margin-right: 0px !important;
        }*/
    .itemdiv > .body > .text {
        padding-bottom: 0px !important;
        /* padding-left: 7px; */
        /*font-size: 13pt ;*/
    }

    .itemdiv {
        padding-right: 3px;
        min-height: 42px;
    }

        .itemdiv > .body > .name {
            color: black;
        }

    .productInvoiceList td:not(:nth-child(5)) {
        color: black !important;
    }

    #producttabletfoot tr td {
        color: black !important;
    }

    td {
        vertical-align: middle !important;
    }
    .table > tbody > tr > td, .table > tfoot > tr > td, .table > thead > tr > th {
        border-right: unset !important;
        border-left: unset !important;
    }
    .table > thead > tr > th {
        border-top: 1px solid #ddd !important;
    }

    .product-search-box clearfix {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
</style>
<div style="padding: 20px;" id="idleadproduct" data-id="@ViewBag.LeadId" data-brand="@brandId">
    <div class="listsearch">
        <div class="flex">
            <div class="check">
                <label style="">Nhãn hàng: </label>
                <select style=" text-align-last: center; width: 200px; height: 26px; border-radius: 3px;" class="item_origin" id="item_origin">
                    <option value="">Chọn nhãn hàng </option>
                    @foreach (var item in origin)
                    {
                        <option value="@item.Value">@item.Name</option>
                    }

                </select>
            </div>
            @*&nbsp;&nbsp;&nbsp;
            <div class="check">
                <label>Tính cho nhãn hàng: </label>
                <select style="text-align-last:center;float:right; width:125px" class="item_countForBrand" id="CountForBrand" name="CountForBrand">
                    <option value="">Chọn nhãn hàng</option>
                    @foreach (var item in origin)
                    {
                        <option value="@item.Value">@item.Name</option>
                    }
                </select>
            </div>*@

        </div>
        <div class="product-search-box clearfix " style="margin-bottom:10px">
            <div class="wrapper-radius">
                <span class="label label-warning" style="padding: 6px 6px; float: left; height: 26px; margin-top: 4px; border-top-left-radius: 3px; border-bottom-left-radius: 3px;">[F4]</span>
                <div id="product_search_control">
                    <span class="ctl">
                        @Html.TextBox("Product", "", new { placeholder = "Sản phẩm/Dịch vụ...", autocomplete = "off", style = "width: 36rem; height:26px; padding: 4px 1.5rem; margin-top: 4px; border-top-right-radius: .5rem !important;border-bottom-right-radius: .5rem !important; background: #fff !important; ", disabled = "true" })
                    </span>
                </div>
            </div>

        </div>
        <div id="listOrderDetail" class="table-responsive " style="padding: 20px; background: white; border-radius: 5px;">
            <table class="table" id="productleadtable">
                <thead>
                    <tr>
                        <th class="grid-header" width="2%"></th>
                        <th class="grid-header" width="4%">STT</th>
                        <th class="grid-header" width="29%">Tên SP/DV</th>
                        <th class="grid-header" width="10%">Nhãn hàng</th>
                        <th class="grid-header" width="9%">SL</th>
                        <th class="grid-header" width="9%">Đơn giá</th>
                        <th class="grid-header" width="9%">Thành tiền</th>
                        <th class="grid-header" width="24%">Ghi chú</th>
                        <th class="grid-header" width="4%">Tặng</th>
                    </tr>
                </thead>
                <tbody class="productInvoiceList">
                    <tr role="0" id="0" hidden>
                        <td class="text-center">
                            <a class="btn-delete-item">
                                <i class="ace-icon fa fa-trash red bigger-120" style="cursor:pointer"></i>
                            </a>
                        </td>
                        <td class="text-center pilstt">
                            1
                        </td>
                        <td>
                            <input class="item_product_id" type="hidden" id="InvoiceList_0__ProductId" name="InvoiceList[0].ProductId" value="0" />
                            <span class="item_product_name"></span>
                        </td>
                        <td>
                            <span class="item_product_origin"></span>
                        </td>
                        <td>
                            <input type="hidden" name="InvoiceList[0].Unit" id="InvoiceList_0__Unit" value="" class="item_unit" />
                            <input class="item_quantity numberinput2" type="text" id="InvoiceList_0__Quantity" name="InvoiceList[0].Quantity" value="0" style="width:100%" />
                        </td>
                        <td>
                            <span class="item_price numberinput2 text-right" type="text" id="InvoiceList_0__Price" name="InvoiceList[0].Price" style="width:100%" />
                        </td>
                        <td id="InvoiceList_0__Total"><span class="item_total"></span></td>
                        <td>
                            <input class="item_note valid_null" type="text" id="InvoiceList_0__Note" name="InvoiceList[0].Note" value="" style="width:100%" />
                        </td>
                        <td class="text-center">
                            <div class="clearfix">
                                <label style="margin-top:5px">

                                    <input id="InvoiceList_0__is_TANG" name="InvoiceList[0].is_TANG" type="checkbox" class="ace item_is_TANG" value="1">
                                    <span class="lbl">
                                    </span>
                                </label>
                            </div>
                        </td>
                        <td style="display:none">
                            <input class="hidden_price numberinput2 text-right" type="text" id="hidden_0__Price" name="hidden[0].Price" value="" style="width:100%" />
                        </td>

                        <td style="display:none" align="right" id="hidden_0__Total"><span class="hidden_total" align="right"></span></td>
                    </tr>
                    @foreach (var leadProduct in datalist)
                    {
                        if(leadProduct.is_TANG == false)
                        {
                            thanh_tien = leadProduct.Price * leadProduct.Quantity;
                            totalt = totalt + thanh_tien;
                        }
                        <tr role="0" id="@(i+1)">
                            <td class="text-center">
                                <input class="item_id" type="hidden" id="InvoiceList_@(i+1)__Id" name="InvoiceList[@(i+1)].Id" value="@leadProduct.Id" />
                                <input class="item_product_id" type="hidden" id="InvoiceList_@(i+1)__ProductId" name="InvoiceList[@(i+1)].ProductId" value="@leadProduct.ProductId" />
                                <input type="checkbox" class="checkbox_child" />
                            </td>
                            <td class="text-center">
                                @(i + 1)
                            </td>
                            <td>
                                <span class="item_product_name">@(leadProduct.Name ?? "")</span>
                            </td>
                            <td>
                                <input class="item_product_origin" type="hidden" id="InvoiceList_@(i+1)__Origin" name="InvoiceList[@(i+1)].Origin" value="@leadProduct.Origin" />
                                <span class="item_product_origin">@(leadProduct.Origin ?? "")</span>
                            </td>
                            <td>
                                <input type="hidden" name="InvoiceList@(i+1).Unit" id="InvoiceList_@(i+1)__Unit" value="@leadProduct.Unit" class="item_unit" />
                                <input class="item_quantity numberinput2 " type="text" id="InvoiceList_@(i+1)__Quantity" name="InvoiceList[@(i+1)].Quantity" value="@leadProduct.Quantity" style="width: 100%;" hidden/>
                                <span class="txt item_quantity_txt">@leadProduct.Quantity</span>
                            </td>
                            <td>
                                <span class="item_price numberinput2 " id="InvoiceList_@(i+1)__Price"  name="InvoiceList[@(i+1)].Price">@FormatNumber.FormatNumberv(leadProduct.Price)</span>
                            </td>
                            <td id="InvoiceList_@(i+1)__Total"><span class="item_total" id="item_@(i+1)__Total">@FormatNumber.FormatNumberv(leadProduct.TotalAmount)</span></td>
                            <td>
                                <input class="item_note" type="text" id="InvoiceList_@(i+1)__Note" name="InvoiceList[@(i+1)].Note" value="@leadProduct.Note" style="width:100%;" hidden/>
                                <span class="txt item_quantity_txt">@leadProduct.Note</span>
                            </td>
                            <td class="text-center">
                                @if (leadProduct.is_TANG == true)
                                {
                                    <div class="clearfix">
                                        <label style="margin-top:5px">
                                            <input id="InvoiceList_@(i + 1)__is_TANG" name="InvoiceList[@(i + 1)].is_TANG" type="checkbox" class="ace item_is_TANG" value="@leadProduct.is_TANG" checked="checked" disabled>
                                            <span class="lbl"></span>
                                        </label>
                                    </div>
                                }
                                else
                                {
                                    <div class="clearfix">
                                        <label style="margin-top:5px">
                                            <input id="InvoiceList_@(i + 1)__is_TANG" name="InvoiceList[@(i + 1)].is_TANG" type="checkbox" class="ace item_is_TANG" value="@leadProduct.is_TANG" disabled>
                                            <span class="lbl"></span>
                                        </label>
                                    </div>
                                }
                            </td>
                            <td style="display:none">
                                <input class="hidden_price numberinput2 text-right" type="text" id="hidden_@(i+1)__Price" name="hidden[@(i+1)].Price" value="@leadProduct.Price" style="width:100%" />
                            </td>
                            <td style="display:none" align="right" id="hidden_@(i+1)__Total"><span class="hidden_total" align="right">@FormatNumber.FormatNumberv(thanh_tien)</span></td>
                            <td style="display:none">
                                @(i++)
                            </td>
                        </tr>
                    }

                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" class="red"><span id="status"></span></td>
                        <td class="productInvoiceList_SL" style="font-weight:bold"></td>
                        <td></td>
                        <td class="productInvoiceList_Amount"  style="font-weight:bold">@(FormatNumber.FormatNumberv(totalt != 0 ? totalt : 0))</td>
                        <td></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <input type="text" class="test" id="test" hidden />

    </div>
</div>
<div id="btnAdd" class="modal-footer" style="display: flex; align-items: center; gap: 1rem;">
    <div style="">
        <div id="editEnableLPShow" style="visibility: hidden;">
            <button id="QuickEditLeadProductEnable" type="button" class="btn btn-primary" style=" padding: .3rem 1.5rem; border-radius: 3px;">Chỉnh sửa</button>
            <div id="editLPDisableShow" hidden>
                <button id="QuickEditLeadProduct" type="button" class="btn btn-primary" style="margin-right: 0 !important;">Lưu</button>
                <button id="QuickEditLeadProductDisable" type="button" class="btn btn-default">Hủy</button>
            </div>
        </div>
    </div>
    <div style="">
        <div style="visibility:hidden;" id="editshowLP">
            <button type="button" class="btn btn-default" style="padding: .3rem 1.5rem; border-radius: 3px;">Xóa</button>
        </div>
    </div>
    <div style="margin-left: auto; visibility: hidden;" id="saveLeadProduct">
        <button type="button" class="btn btn-primary2" style="margin-right: 110px; padding: 3px 25px !important;">Lưu</button>
    </div>
</div>
<script src="/Scripts/combojax.js?=vs1.01211"></script>
<script src="~/Scripts/tabLeadProduct.js"></script>


