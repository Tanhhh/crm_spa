@using Erp.BackOffice.App_GlobalResources
@using Erp.BackOffice.Helpers
@using Erp.BackOffice.Sale.Models
@using Erp.Domain.Sale.Entities
@using GridMvc.Html

@model  DM_BANNER_SLIDERViewModel

@{
    ViewBag.Title = "Danh mục Banner Slider";
    bool isPopup = Request["IsPopup"] != null && Request["IsPopup"].ToString().ToLower() == "true" ? true : false;
    if (isPopup)
    {
        Layout = "~/Views/Shared/_PopupLayout.cshtml";
    }
    else
    {
        Layout = "~/Views/Shared/ACE_AdminLayout.cshtml";
    }
    var jsCallback = Request["jsCallback"] == null ? "" : Request["jsCallback"].ToString();
    Erp.BackOffice.Models.PageSetting pageSetting = new Erp.BackOffice.Models.PageSetting
    {
        ModuleName = "DM_CAMNHAN_KHANG",
        ActionName = "DM_BannerSlider",
        PageTitle = ViewBag.Title,
        DisplaySearchPanel = false,
        IsPopup = false,
        DisplayBackButton = false
    };
    List<DM_BANNER_SLIDERViewModel> dm_bannerslider = (List<DM_BANNER_SLIDERViewModel>)ViewBag.DM_BANNER_SLIDER;
}

<link href="@Url.Content("~/assets/css/Gridmvc.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/gridmvc.min.js")" type="text/javascript">
    /**/

    /**/</script>

<style type="text/css">
    .input-edit-inline {
        height: 23px;
        line-height: 23px;
        font-size: 10px;
    }

    .subItem2 {
        border: 1px solid #ddd;
        margin-left: -8px;
        margin-right: -8px;
        padding: 8px;
        border-width: 1px 0px 0px 0px;
        height: 39px;
    }

    .subItem {
        height: 22px;
    }

    .createupdateheader {
        font-size: large;
        font-weight: bold;
    }

    #scroll {
        overflow: scroll;
    }

    @@media only screen and (max-device-width: 2560px) {
        #btnRS {
            padding-left: 44% !important;
            margin-right: 5px;
        }

        #btnSave {
            width: 6%;
        }

        #save {
            width: 100%;
        }
    }

    @@media only screen and (max-device-width: 425px) {
        #STT {
            width: 100%;
            margin-bottom: 5px;
        }

        #LINK {
            width: 100%;
            margin-bottom: 10px;
        }

        #btnRS {
            padding-left: 25% !important;
            margin-right: 5px;
            padding-bottom: 5px;
        }

        .btn .btn-mini .btn-black {
            width: 100%;
        }

        #btnSave {
            width: 50%;
        }

        #save {
            width: 45%;
        }

        #image {
            width: 100%;
        }
    }

    @@media only screen and (max-device-width: 320px) {
        #btnRS {
            padding-left: 20% !important;
        }

        #save {
            width: 57%;
        }
    }
</style>
@using (Html.BeginPageHeaderContainer(pageSetting))
{
    <input type="hidden" value="@Request["IsPopup"]" name="IsPopup" />
    <input type="hidden" value="@Request["jsCallback"]" name="jsCallback" />
}

@if (ViewBag.SuccessMessage != null && ViewBag.SuccessMessage != "")
{
    <div class="alert alert-block alert-success">
        <button class="close" data-dismiss="alert" type="button">
            <i class="icon-remove"></i>
        </button>
        <i class="ace-icon fa fa-check green"></i>
        @ViewBag.SuccessMessage
    </div>
}

@if (ViewBag.FailedMessage != null && ViewBag.FailedMessage != "")
{
    <div class="alert alert-block alert-error">
        <button class="close" data-dismiss="alert" type="button">
            <i class="icon-remove"></i>
        </button>
        <i class="icon-warning-sign red"></i>
        @ViewBag.FailedMessage
    </div>
}

@if (ViewBag.AlertMessage != null && ViewBag.AlertMessage != "")
{
    <div class="alert alert-block alert-success">
        <button class="close" data-dismiss="alert" type="button">
            <i class="icon-remove"></i>
        </button>
        <i class="ace-icon fa fa-check green"></i>
        @ViewBag.AlertMessage
    </div>
}

@helper GridColumnCommand(int id)
{
                    /**/
    <div class="hidden-phone visible-desktop action-buttons">
        @using (Html.BeginForm("DeleteBannerSlider", "DM_CAMNHAN_KHANG", FormMethod.Post))
        {
            if (Erp.BackOffice.Filters.SecurityFilter.AccessRight("DeleteBannerSlider", "DM_CAMNHAN_KHANG", "Sale"))
            {
                <input type="hidden" value="@id" name="Id" />
                <button type="submit" class="btn btn-minier btn-danger" onclick="return confirm('Bạn có muốn xóa dữ liệu không ?');" style="margin-top:-3px">
                    <i class="ace-icon fa fa-trash"></i>
                    Xóa
                </button>
            }
        }
    </div>
}

@helper RenderEditItem(int id, int stt, string banner, int? is_show, int? is_mobile, bool? is_KH, int? is_DV, int? is_SP, int? is_LogoMbile,int? isFooterWeb, string Link)
{
                    /**/


                    var bannersrc = Erp.BackOffice.Helpers.Common.KiemTraTonTaiHinhAnh(banner, "banner-image-folder", "banner");
                    if (!string.IsNullOrEmpty(banner))
                    {
                        bannersrc = "~" + bannersrc;
                    }

                    <a id="edit" class="btn btn-info btn-minier" onclick="return edit(@id, @stt,'@bannersrc','@banner',@is_show ,@is_mobile,'@is_KH.ToString()','@is_DV.ToString()','@is_SP.ToString()','@is_LogoMbile.ToString()','@isFooterWeb.ToString()','@Link')" style="margin-top:-3px">
                        <i class="ace-icon fa fa-edit"></i>
                        Sửa
                    </a>
}

@helper isshow(int id, int? is_show)
{
                    /**/
    <label>
        <input id="is_show_table" class="ace class-is-show text-center" disabled type="checkbox" name="is-show-table" value="@is_show" checked="@(is_show == 1? "checked":null)">
        <span class="lbl"></span>
    </label>
}
@helper ismobile(int id, int? is_mobile)
{
                    /**/
    <label>
        <input id="is_mobile_table" class="ace class-is-mobile text-center" disabled type="checkbox" name="is-mobile-table" value="@is_mobile" checked="@(is_mobile == 1? "checked":null)">
        <span class="lbl"></span>
    </label>
}
@helper isKH(int id, bool? is_KH)
{
                    /**/
    <label>
        <input id="is_KH_table" class="ace class-is-mobile text-center" disabled type="checkbox" name="is-mobile-table" value="@is_KH" checked="@(is_KH == true?"checked":null)">
        <span class="lbl"></span>
    </label>
}
@helper isDV(int id, int? is_DV)
{
                    /**/
    <label>
        <input id="is_KH_table" class="ace class-is-mobile text-center" disabled type="checkbox" name="is-mobile-table" value="@is_DV" checked="@(is_DV == 1?"checked":null)">
        <span class="lbl"></span>
    </label>
}
@helper isSP(int id, int? is_SP)
{
                    /**/
    <label>
        <input id="is_KH_table" class="ace class-is-mobile text-center" disabled type="checkbox" name="is-mobile-table" value="@is_SP" checked="@(is_SP == 1?"checked":null)">
        <span class="lbl"></span>
    </label>
}
@helper isLGMB(int id, int? is_LGMB)
{
                    /**/
    <label>
        <input id="is_LGMB_table" class="ace class-is-mobile text-center" disabled type="checkbox" name="is-mobile-table" value="@is_LGMB" checked="@(is_LGMB == 1?"checked":null)">
        <span class="lbl"></span>
    </label>
}
@helper isFooterWeb(int id, int? is_FooterWeb)
{
                    /**/
    <label>
        <input id="is_FooterWeb_table" class="ace class-is-mobile text-center" disabled type="checkbox" name="is-mobile-table" value="@is_FooterWeb" checked="@(is_FooterWeb == 1?"checked":null)">
        <span class="lbl"></span>
    </label>
}
@helper ShowImage(int id, string banner)
{
                    /**/

                    var bannersrc = Erp.BackOffice.Helpers.Common.KiemTraTonTaiHinhAnh(banner, "banner-image-folder", "banner");
                    if (!string.IsNullOrEmpty(banner))
                    {
                        bannersrc = bannersrc;
                    }
                    <div class="text-center ace-thumbnails">
                        <a id="showimage_@id" name="showimage" href="@bannersrc" data-rel="colorbox" class="cboxElement">
                            <span class="glyphicon glyphicon-picture"></span>Xem
                        </a>
                    </div>

}
<hr>
@using (Html.BeginForm("CreateBannerSlider", "DM_CAMNHAN_KHANG", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.ValidationSummary(true)
    @Html.HiddenFor(model => model.CreatedUserId)
    @Html.HiddenFor(model => model.CreatedDate)
    @Html.HiddenFor(model => model.IsDeleted)
    @Html.HiddenFor(model => model.ANH_DAIDIEN)
    @Html.HiddenFor(model => model.BANNER_SLIDER_ID)
    //////////
    ////////
    <p id="createupdateheader" class="createupdateheader text-center"><span>Tạo Banner Slider</span></p>

    <div class="row">
        <div class="col-sm-12">
            <div class="widget-container-col ui-sortable" id="widget-container-col-10" style="min-height: 108px;">
                <div class="widget-box ui-sortable-handle" id="widget-box-10" style="opacity: 1;">
                    <div class="widget-header widget-header-small">
                        <div class="widget-toolbar no-border pull-left">
                            <ul class="nav nav-tabs" id="myTab">
                                <li class="active">
                                    <a data-toggle="tab" href="#home" aria-expanded="true"><i class="fa fa-info-circle"></i> Tổng quan</a>
                                </li>
                                <li class="">
                                    <a data-toggle="tab" href="#image" aria-expanded="false"><i class="fa fa-image"></i> Ảnh Đại Diện</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="widget-body" style="overflow: hidden;">
                        <div class="widget-body">
                            <div class="widget-main padding-6">
                                <div class="tab-content">
                                    <div id="home" class="tab-pane active">
                                        <p align="center">
                                            @Html.TextBoxFor(model => model.STT, new { @class = "", autocomplete = "off", placeholder = "STT", @Value = (@Model.STT == 0) ? "" : @Model.STT.ToString() })

                                            @Html.TextBoxFor(model => model.LINK, new { @class = "", autocomplete = "off", @placeholder = "LINK" })

                                            <span>Hiện</span>
                                            <label>
                                                <input id="is_show" class="ace class-is-show" type="checkbox" name="is-show-checkbox" value="1" checked="checked">
                                                <span class="lbl"></span>
                                            </label>
                                            <span>Hiển thị Mobile</span>
                                            <label>
                                                <input id="is_mobile" class="ace class-is-show" type="checkbox" name="is-mobile-checkbox" value="1">
                                                <span class="lbl"></span>
                                            </label>
                                            <span>Khách hàng</span>
                                            <label>
                                                <input id="is_KH" class="ace class-is-show" type="checkbox" name="is-KH-checkbox" value="true">
                                                <span class="lbl"></span>
                                            </label>

                                            <span>Dịch vụ</span>
                                            <label>
                                                <input id="is_DV" class="ace class-is-show" type="checkbox" name="is-DV-checkbox" value="1">
                                                <span class="lbl"></span>
                                            </label>

                                            <span>Sản phẩm</span>
                                            <label>
                                                <input id="is_SP" class="ace class-is-show" type="checkbox" name="is-SP-checkbox" value="1">
                                                <span class="lbl"></span>
                                            </label>

                                            <span>Hình nền Login Mobile</span>
                                            <label>
                                                <input id="is_LogoMbile" class="ace class-is-show" type="checkbox" name="is-LGMB-checkbox" value="1">
                                                <span class="lbl"></span>
                                            </label>
                                            <span>Banner Footer Web</span>
                                            <label>
                                                <input id="is_FooterWeb" class="ace class-is-show" type="checkbox" name="is-FooterWEB-checkbox" value="1">
                                                <span class="lbl"></span>
                                            </label>
                                        </p>

                                    </div>
                                    <div id="image" class="tab-pane">
                                        <div class="wrap-btn-upload">
                                            <a class="btn btn-primary btn-sm btn-white"><i class="fa fa-upload"></i><span>Tải hình mới</span></a>
                                            <input type="file" id="file-image" name="file-image" class="file-image" onchange="previewFileImage(event, '#display-image img')" />
                                        </div>
                                        <div class="text-center" id="display-image">
                                            @if (Model.ANH_DAIDIEN != "")
                                            {
                                                <img src="/assets/css/images/noimage.gif" title="@Model.BANNER_SLIDER_ID" id="image" style="max-height:250px" />
                                            }
                                            else
                                            {

                                                <img src="@Model.ANH_DAIDIEN" title="@Model.BANNER_SLIDER_ID" id="" style="max-height:250px" />
                                            }

                                        </div>
                                    </div>
                                </div>
                                <div id="btnRS" style="float:left;padding-left:10%;">
                                    <a class="btn btn-mini btn-black" onclick="return reset()">
                                        Nhập lại
                                        <i class="ace-icon fa fa-refresh icon-on-right"></i>
                                    </a>
                                </div>

                                <div id="btnSave" style="float:left;">
                                    @if (Erp.BackOffice.Filters.SecurityFilter.AccessRight("CreateBannerSlider", "DM_CAMNHAN_KHANG", "Sale"))
                                    {
                                        <button id="save" name="Save" value="Save" type="submit" class="btn btn-mini btn-primary" href="@Url.Action("CreateBannerSlider", pageSetting.ModuleName)">
                                            <i class="ace-icon fa fa-plus"></i>
                                            Lưu
                                        </button>
                                    }
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<hr>
<div id="scroll">
    <table class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th width="10" style="text-align:center">ID</th>
                <th style="width:10px;text-align:center">Ảnh minh họa</th>
                <th style="width:10px;text-align:center">Link</th>
                <th style="width:10px;text-align:center">Hiện</th>
                <th style="width:10px;text-align:center">Hiển thị Mobile</th>
                <th style="width:10px;text-align:center">Khách hàng</th>
                <th style="width:10px;text-align:center">Dịch vụ</th>
                <th style="width:10px;text-align:center">Sản phẩm</th>
                <th style="width:10px;text-align:center">Login Mobile</th>
                <th style="width:10px;text-align:center">Banner Footer</th>
                <th style="width:10px;text-align:center">Thứ tự</th>
                <th style="width:10px;text-align:center">Chỉnh sửa</th>
                <th style="width:10px;text-align:center">Xóa</th>
            </tr>
        </thead>
        <tbody style="text-align:center">
            @foreach (var item in dm_bannerslider)
            {
                var subList = dm_bannerslider.ToList(); //.Where(i => i.LOAISANPHAM_IDCHA == item.LOAISANPHAM_ID).ToList();

                <tr>
                    <td>
                        <i style="cursor:pointer" class="fa @(subList.Count > 0 ? "btn-group fa-plus-square-o" : "") bigger-120" data-id="@item.BANNER_SLIDER_ID">
                            <b id="label_name_@item.BANNER_SLIDER_ID " style="font-family:'open sans'">@item.BANNER_SLIDER_ID</b>
                        </i>
                    </td>
                    <td>@ShowImage(item.BANNER_SLIDER_ID, item.ANH_DAIDIEN)</td>
                    <td><a href="@item.LINK"> @item.LINK </a> </td>
                    <td>@isshow(item.BANNER_SLIDER_ID, item.IS_SHOW)</td>
                    <td>@ismobile(item.BANNER_SLIDER_ID, item.IS_MOBILE)</td>
                    <td>@isKH(item.BANNER_SLIDER_ID, item.IsKH)</td>
                    <td>@isDV(item.BANNER_SLIDER_ID, item.isDichVu)</td>
                    <td>@isSP(item.BANNER_SLIDER_ID, item.isSanPham)</td>
                    <td>@isLGMB(item.BANNER_SLIDER_ID, item.isLogoMobile)</td>
                    <td>@isFooterWeb(item.BANNER_SLIDER_ID, item.isFooterWeb)</td>
                    <td>@item.STT</td>
                    <td>@RenderEditItem(item.BANNER_SLIDER_ID, item.STT, item.ANH_DAIDIEN, item.IS_SHOW, item.IS_MOBILE, item.IsKH, item.isDichVu, item.isSanPham, item.isLogoMobile,item.isFooterWeb, item.LINK)</td>
                    <td>@GridColumnCommand(item.BANNER_SLIDER_ID)</td>
                </tr>



            }
        </tbody>
    </table>
</div>


@section Scripts {
    <script type="text/javascript">
        $(function () {
            $(".btn-group").click(function () {
                var id = $(this).data("id");
                var on = $(this).hasClass("on");
                if (on) {
                    $(".item_of_" + id).hide();
                    $(this).removeClass("on");
                    $(this).removeClass("fa-minus-square-o");
                    $(this).addClass("fa-plus-square-o");
                }
                else {
                    $(".item_of_" + id).show();
                    $(this).addClass("on");
                    $(this).removeClass("fa-plus-square-o");
                    $(this).addClass("fa-minus-square-o");
                }
            });
        });

        function edit(id, stt, bannersrc, banner, is_show, is_mobile, is_KH, is_DV, is_SP, is_LogoMbile,isFooterWeb, Link) {
            debugger
            $("#BANNER_SLIDER_ID").val(id);
            $("#LINK").val(Link);
            $("#STT").val(stt);
            $("#ANH_DAIDIEN").val(banner);
            $("#display-image img").attr("src", "../Uploads/banner/" + banner);
            $("#createupdateheader").text("Sửa banner slider - " + id);
            if (is_show == 1) {
                $("#is_show").prop('checked', true);
            }
            else {
                $("#is_show").prop('checked', false);
            }
            if (is_mobile == 1) {
                $("#is_mobile").prop('checked', true);
            } else {
                $("#is_mobile").prop('checked', false);
            }
            if (is_KH == 'True') {
                $("#is_KH").prop('checked', true);
            }
            else {
                $("#is_KH").prop('checked', false);
            }
            if (is_DV == 1) {
                $("#is_DV").prop('checked', true);
            } else {
                $("#is_DV").prop('checked', false);
            }
            if (is_SP == 1) {
                $("#is_SP").prop('checked', true);
            } else {
                $("#is_SP").prop('checked', false);
            }
            if (is_LogoMbile == 1) {
                $("#is_LogoMbile").prop('checked', true);
            } else {
                $("#is_LogoMbile").prop('checked', false);
            }
            if (isFooterWeb == 1) {
                $("#is_FooterWeb").prop('checked', true);
            } else {
                $("#is_FooterWeb").prop('checked', false);
            }
        }

        function reset() {
            $("#BANNER_SLIDER_ID").val(0);
            $("#LINK").val("");
            $("#STT").val("");
            $("#display-image img").attr("src", "/assets/css/images/noimage.gif");
            $("#createupdateheader").text("Tạo Banner Slider");
            $("#is_show").prop('checked', true);
            $("#is_mobile").prop('checked', true);
            $("#is_KH").prop('checked', true);
            $("#is_SP").prop('checked', true);
            $("#is_DV").prop('checked', true);
            $("#is_LogoMbile").prop('checked', true);
            $("#is_FooterWeb").prop('checked', true);

        }

    </script>
}


